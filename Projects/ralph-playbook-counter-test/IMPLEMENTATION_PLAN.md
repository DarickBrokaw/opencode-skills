# IMPLEMENTATION PLAN - Counter Fixture

## Status: IN_PROGRESS
**Generated by:** Ralph-loop PLAN phase
**Date:** 2026-01-21

---

## Gap Analysis Summary

**Current State:**
- ✅ `counter.txt` exists with initial value "0"
- ✅ Test file `tests/test_counter.py` exists with 2 test cases
- ✅ Project structure and dependencies configured
- ❌ `src/counter_fixture/core.py` - empty stub (2 lines)
- ❌ `src/counter_fixture/cli.py` - returns "TODO", exit code 1
- ❌ No library functions implemented (read_counter, write_counter, increment_counter)
- ❌ No CLI commands implemented (get, inc, run --target)
- ❌ Tests failing ("CLI not implemented")
- ❌ No git tag for initial state

**Required Implementation:**

---

## Implementation Tasks (Priority Order)

### Phase 1: Core Library Implementation
- [ ] **TASK-1**: Implement `read_counter(path) -> int` in `src/counter_fixture/core.py`
  - Read first line of file, parse as integer
  - Handle missing file error (FileNotFoundError)
  - Handle non-integer content error (ValueError)
  
- [ ] **TASK-2**: Implement `write_counter(path, value: int) -> None` in `src/counter_fixture/core.py`
  - Write integer + newline to file
  - Ensure exact format per specs
  
- [ ] **TASK-3**: Implement `increment_counter(path) -> int` in `src/counter_fixture/core.py`
  - Read current value, increment by exactly +1
  - Write back new value, return it
  - Maintain invariants per specs

### Phase 2: CLI Implementation
- [ ] **TASK-4**: Implement `get` command in `src/counter_fixture/cli.py`
  - Read counter.txt, print integer value
  - Exit code 0 on success
  
- [ ] **TASK-5**: Implement `inc` command in `src/counter_fixture/cli.py`
  - Increment counter, print new value
  - Exit code 0 on success
  
- [ ] **TASK-6**: Implement `run --target N` command in `src/counter_fixture/cli.py`
  - Increment until reaching exact target
  - Do not overshoot
  - Print final value, exit code 0

### Phase 3: Validation & Cleanup
- [ ] **TASK-7**: Run `python -m pytest` - all tests must pass
- [ ] **TASK-8**: Run `python -m ruff check .` - no errors
- [ ] **TASK-9**: Run `python -m ruff format --check .` - no format issues
- [ ] **TASK-10**: Create git tag `0.0.1` for initial green state

---

## Validation Gates (per iteration)

After each implementation task:
1. Run `python -m pytest` 
2. Run `python -m ruff check .`
3. Run `python -m ruff format --check .`
4. If all pass: commit changes with descriptive message

---

## Notes

- Follow deterministic library patterns per `specs/core-counter.md`
- CLI must be runnable as `python -m counter_fixture <command>`
- Keep output minimal for testability
- Maintain atomic commits (one feature per commit)
- Update this plan after each successful iteration

---

*This plan will be executed in BUILD mode, one task per Ralph-loop iteration.*
